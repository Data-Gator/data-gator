\doxysection{ble\+\_\+util.\+hpp}
\hypertarget{ble__util_8hpp_source}{}\label{ble__util_8hpp_source}\index{include/ble\_util.hpp@{include/ble\_util.hpp}}
\mbox{\hyperlink{ble__util_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#ifndef\ BLE\_UTIL\_HPP}}
\DoxyCodeLine{00009\ \textcolor{preprocessor}{\#define\ BLE\_UTIL\_HPP}}
\DoxyCodeLine{00010\ }
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <NimBLEAdvertisedDevice.h>}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{BLESensor_8hpp}{BLESensor.hpp}}>}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <MinewS1.hpp>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <KKM\_K6P.hpp>}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger_8hpp}{logger.hpp}}>}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classScanCallbacks}{ScanCallbacks}}:\ \textcolor{keyword}{public}\ NimBLEAdvertisedDeviceCallbacks\ \{}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordtype}{void}\ onResult(NimBLEAdvertisedDevice*\ dev)\{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Serial.printf("{}Advertised\ Device:\ \%s\(\backslash\)n"{},\ dev.toString().c\_str());}}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ MinewS1\ s1\_interpreter\ =\ MinewS1::getInstance();}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isS1\ =\ s1\_interpreter.advertisedDeviceIsS1(dev);}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ KKMK6P\ k6p\ =\ KKMK6P::getInstance();}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isK6P\ =\ k6p.advertisedDeviceIsK6P(dev);}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(isK6P)\{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ parse\ data}}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ MQTTMail*\ mail\_ptr\ =\ k6p.parseAdvertisedData(dev);}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ sent\ BLE\ mail\ to\ publisher"{}});}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ MQTTMailer\ instance\ =\ MQTTMailer::getInstance();}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(WiFi.status()\ ==\ WL\_CONNECTED\ \&\&\ !mqtt\_client.connected())\{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ not\ connected"{}});}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ instance.reconnect(mqtt\_client);}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{"{}}\ +\ mail\_ptr-\/>getMessage()\ +\ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}GATOR\_MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ WiFi.macAddress().c\_str()\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ mail\_ptr-\/>getTopic(),\ msg);}}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(mail\_ptr-\/>getTopic(),\ msg);}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}(mail\_ptr);}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ mail\_ptr\ =\ NULL;}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(isS1)\{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ MQTTMail*\ mail\_ptr\ =\ s1\_interpreter.parseAdvertisedData(dev);\ \textcolor{comment}{//\ print\ the\ advertised\ data\ after\ interpretation}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(mail\_ptr\ !=\ NULL)\{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ sent\ BLE\ mail\ to\ publisher"{}});}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MQTTMailer\ instance\ =\ MQTTMailer::getInstance();}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(WiFi.status()\ ==\ WL\_CONNECTED\ \&\&\ !mqtt\_client.connected())\{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ not\ connected"{}});}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ instance.reconnect(mqtt\_client);}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{"{}}\ +\ mail\_ptr-\/>getMessage()\ +\ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}GATOR\_MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ WiFi.macAddress().c\_str()\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ mail\_ptr-\/>getTopic(),\ msg);}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(mail\_ptr-\/>getTopic(),\ msg);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}(mail\_ptr);}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mail\_ptr\ =\ NULL;}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \}\ \ \ }
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ \};}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
