\doxysection{ble\+\_\+util.\+hpp}
\hypertarget{ble__util_8hpp_source}{}\label{ble__util_8hpp_source}\index{include/ble\_util.hpp@{include/ble\_util.hpp}}
\mbox{\hyperlink{ble__util_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#ifndef\ BLE\_UTIL\_HPP}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#define\ BLE\_UTIL\_HPP}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <NimBLEAdvertisedDevice.h>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{BLESensor_8hpp}{BLESensor.hpp}}>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{MinewS1_8hpp}{MinewS1.hpp}}>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{KKM__K6P_8hpp}{KKM\_K6P.hpp}}>}\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{logger_8hpp}{logger.hpp}}>}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classScanCallbacks}{ScanCallbacks}}:\ \textcolor{keyword}{public}\ NimBLEAdvertisedDeviceCallbacks\ \{}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classScanCallbacks_ac34f6efbb63fc4bde3722c9374765d33}{onResult}}(NimBLEAdvertisedDevice*\ dev)\{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Serial.printf("{}Advertised\ Device:\ \%s\(\backslash\)n"{},\ dev.toString().c\_str());}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMinewS1}{MinewS1}}\ s1\_interpreter\ =\ MinewS1::getInstance();}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isS1\ =\ s1\_interpreter.\mbox{\hyperlink{classMinewS1_a8fd6ef466cfcc5a2bc392fb14ba9714a}{advertisedDeviceIsS1}}(dev);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classKKMK6P}{KKMK6P}}\ k6p\ =\ KKMK6P::getInstance();}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ isK6P\ =\ k6p.\mbox{\hyperlink{classKKMK6P_a67d9a10adb8aa11845908b91cd60672d}{advertisedDeviceIsK6P}}(dev);}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(isK6P)\{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ parse\ data}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMQTTMail}{MQTTMail}}*\ mail\_ptr\ =\ k6p.\mbox{\hyperlink{classKKMK6P_a7a4c85775cff70eea90c2d285151ca6c}{parseAdvertisedData}}(dev);}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{src_2main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ sent\ BLE\ mail\ to\ publisher"{}});}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMQTTMailer}{MQTTMailer}}\ instance\ =\ MQTTMailer::getInstance();}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(WiFi.status()\ ==\ WL\_CONNECTED\ \&\&\ !\mbox{\hyperlink{update_8cpp_a965861de1a367ef4c2b467de34de2683}{mqtt\_client}}.connected())\{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{src_2main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ not\ connected"{}});}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ instance.\mbox{\hyperlink{classMQTTMailer_af60393c05c00cebf768f3f3ed16b02bd}{reconnect}}(\mbox{\hyperlink{update_8cpp_a965861de1a367ef4c2b467de34de2683}{mqtt\_client}});}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{"{}}\ +\ mail\_ptr-\/>\mbox{\hyperlink{classMQTTMail_a95a2c8d07b9f90be5aac3b00a95ab536}{getMessage}}()\ +\ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}GATOR\_MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ WiFi.macAddress().c\_str()\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ mail\_ptr-\/>getTopic(),\ msg);}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(mail\_ptr-\/>\mbox{\hyperlink{classMQTTMail_a5e8c97cecd9e682e93189f81ad322fe9}{getTopic}}(),\ msg);}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}(mail\_ptr);}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ mail\_ptr\ =\ NULL;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(isS1)\{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMQTTMail}{MQTTMail}}*\ mail\_ptr\ =\ s1\_interpreter.\mbox{\hyperlink{classMinewS1_a32fdfcebb661e3b239fdb533aee59157}{parseAdvertisedData}}(dev);\ \textcolor{comment}{//\ print\ the\ advertised\ data\ after\ interpretation}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(mail\_ptr\ !=\ NULL)\{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{src_2main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ sent\ BLE\ mail\ to\ publisher"{}});}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMQTTMailer}{MQTTMailer}}\ instance\ =\ MQTTMailer::getInstance();}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(WiFi.status()\ ==\ WL\_CONNECTED\ \&\&\ !\mbox{\hyperlink{update_8cpp_a965861de1a367ef4c2b467de34de2683}{mqtt\_client}}.connected())\{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{src_2main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ not\ connected"{}});}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ instance.\mbox{\hyperlink{classMQTTMailer_af60393c05c00cebf768f3f3ed16b02bd}{reconnect}}(\mbox{\hyperlink{update_8cpp_a965861de1a367ef4c2b467de34de2683}{mqtt\_client}});}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{"{}}\ +\ mail\_ptr-\/>\mbox{\hyperlink{classMQTTMail_a95a2c8d07b9f90be5aac3b00a95ab536}{getMessage}}()\ +\ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}GATOR\_MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ WiFi.macAddress().c\_str()\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\}"{}};}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ mail\_ptr-\/>getTopic(),\ msg);}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(mail\_ptr-\/>\mbox{\hyperlink{classMQTTMail_a5e8c97cecd9e682e93189f81ad322fe9}{getTopic}}(),\ msg);}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}(mail\_ptr);}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mail\_ptr\ =\ NULL;}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \}\ \ \ }
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ \};}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
