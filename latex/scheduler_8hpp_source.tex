\doxysection{scheduler.\+hpp}
\hypertarget{scheduler_8hpp_source}{}\label{scheduler_8hpp_source}\index{include/scheduler.hpp@{include/scheduler.hpp}}
\mbox{\hyperlink{scheduler_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#ifndef\ SCHEDULER\_HPP}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ SCHEDULER\_HPP}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{//\#include\ <setup\_util.hpp>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <NimBLEDevice.h>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <Adafruit\_MAX1704X.h>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <OWMAdafruit\_ADS1015.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{ble__util_8hpp}{ble\_util.hpp}}>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{VWCSensor_8hpp}{VWCSensor.hpp}}>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <Teros10.hpp>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <Atlas\_EZO-\/pH.hpp>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <Atlas\_Gravity\_pH.hpp>}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{bool}\ maxlipo\_attached;}
\DoxyCodeLine{00028\ \textcolor{keyword}{extern}\ Adafruit\_MAX17048\ \mbox{\hyperlink{scheduler_8hpp_a106fc9194d62779ffe942b866046530d}{maxlipo}};}
\DoxyCodeLine{00029\ \textcolor{keyword}{extern}\ Adafruit\_ADS1115\ \mbox{\hyperlink{scheduler_8hpp_a951ac31de71c2bf701a13e5f233fc6d8}{ads}};}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keywordtype}{int}\ reset\_count\ =\ -\/1;\ \textcolor{comment}{//\ times\ reset\ by\ WDT,\ one\ tick\ roughly\ equivalent\ to\ one\ minute}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structplanner}{planner}}\{}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ =\ -\/1;\ \ \ \ \ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}}\ =\ -\/1;\ \ \ \ \ \ \ \ }
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}}\ =\ -\/1;\ \ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}}\ =\ -\/1;\ \ }
\DoxyCodeLine{00047\ \}\mbox{\hyperlink{structplanner}{planner}};}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00052\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_aa2c353c6e3271404cdf45ce4601951c7}{init\_nvs}}()\{}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ NVS\ Setup}}
\DoxyCodeLine{00055\ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.begin(\textcolor{stringliteral}{"{}GatorState"{}},\ RW\_MODE);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.isKey(\textcolor{stringliteral}{"{}reset\_count"{}}))\{\ \textcolor{comment}{//\ if\ key\ exists}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ reset\_count\ =\ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.getInt(\textcolor{stringliteral}{"{}reset\_count"{}});}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ reset\_count++;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\ Serial.printf(\textcolor{stringliteral}{"{}Reset\ Count\ =\ \%d\(\backslash\)n"{}},\ reset\_count);}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}reset\_count"{}},\ reset\_count);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ =\ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.getInt(\textcolor{stringliteral}{"{}analog\_t0"{}});}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}}\ =\ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.getInt(\textcolor{stringliteral}{"{}ht\_t0"{}});}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}}\ =\ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.getInt(\textcolor{stringliteral}{"{}ota\_t0"{}});}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}}\ =\ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.getInt(\textcolor{stringliteral}{"{}tlm\_t0"{}});}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \}\textcolor{keywordflow}{else}\{\ \textcolor{comment}{//\ create\ the\ keys}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ reset\_count\ =\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ =\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}}\ =\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}}\ =\ 1;}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\ Serial.printf(\textcolor{stringliteral}{"{}Reset\ Count\ =\ \%d\(\backslash\)n"{}},\ reset\_count);}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}reset\_count"{}},\ reset\_count);\ \ }
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}analog\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}});}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ht\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}});}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ota\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}});}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}tlm\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}});}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00086\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{scheduler_8hpp_acde0b5aea233a35b69ff211f55208c6b}{task\_is\_scheduled}}(\textcolor{keywordtype}{int}\ reset\_count)\{}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_vwc\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_a63929664348237323cf24eda9d046748}{VWC\_FREQ}};}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_ht\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_ab8f6d4487aad03d548ccaba7645f7722}{HT\_FREQ}};}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_ota\_update\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_a5420655b6c292f8b3999b35374ff686a}{OTA\_FREQ}};}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_tlm\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_a4665514bc689b72073e4f94e00e0cb1e}{TLM\_FREQ}};}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{if}(\ run\_vwc\ ||\ run\_ht\ ||\ run\_ota\_update\ ||\ run\_tlm)\{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ start\ WIFI}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00095\ \ \ \ \ \}\textcolor{keywordflow}{else}\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00102\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_a2ce5745ffb225d3a8167ba1970e3b777}{ReadHT}}()\{}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}[HT]"{}});}
\DoxyCodeLine{00104\ \ \ \ \ NimBLEScan*\ scanner\ =\ NimBLEDevice::getScan();}
\DoxyCodeLine{00105\ \ \ \ \ scanner-\/>setAdvertisedDeviceCallbacks(\textcolor{keyword}{new}\ \mbox{\hyperlink{classScanCallbacks}{ScanCallbacks}}());}
\DoxyCodeLine{00106\ \ \ \ \ scanner-\/>setActiveScan(\textcolor{keyword}{true});\ \ \ \textcolor{comment}{//\ retrieve\ results\ from\ all\ scanned\ devices}}
\DoxyCodeLine{00107\ \ \ \ \ scanner-\/>setInterval(100);\ \ \ \ \ \ \textcolor{comment}{//\ time\ between\ scans??}}
\DoxyCodeLine{00108\ \ \ \ \ scanner-\/>setWindow(99);\ \ \ \ \ \textcolor{comment}{//\ less\ than\ or\ equal\ to\ setInterval,\ is\ how\ long\ to\ scan\ for}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{comment}{//scanner-\/>start(5,\ true);}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordtype}{int}\ scanTime\ =\ 10;\ \textcolor{comment}{//\ in\ seconds}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ BLEScanResults\ res\ =\ scanner-\/>start(scanTime,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00114\ \ \ \ \ scanner-\/>clearResults();}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00120\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_ae6b4c9f02d24e6345a8244b129cb4bce}{ReadWired}}()\{}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}[VWC/WIRED\ SENSORS]\ queueing\ data"{}});}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ turn\ on\ power\ to\ sensors}}
\DoxyCodeLine{00125\ \ \ \ \ digitalWrite(\mbox{\hyperlink{pinout_8hpp_ab241a96e494c05c7b5288a549f6c0c01}{PWR\_EN}},\ HIGH);}
\DoxyCodeLine{00126\ \ \ \ \ delay(10000);}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ initialize\ sensor\ readers}}
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{classVWCSensor}{VWCSensor}}*\ vwc\_converter\ =\ \textcolor{keyword}{new}\ Teros10();}
\DoxyCodeLine{00130\ \ \ \ \ \mbox{\hyperlink{classpHSensor}{pHSensor}}*\ pH\_converter\ =\ \textcolor{keyword}{new}\ AtlasGravitypH();}
\DoxyCodeLine{00131\ \ \ \ \ AtlasEZOpH*\ ezopH\_converter\ =\ \textcolor{keyword}{new}\ AtlasEZOpH();}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ MQTTMailer\ instance\ =\ MQTTMailer::getInstance();}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ get\ the\ MAC\ address}}
\DoxyCodeLine{00135\ \ \ \ \ std::string\ mac\_str(WiFi.macAddress().c\_str());}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{int}\ raw\_analog[4];}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{double}\ voltage[4];}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ read\ voltage\ at\ analog\ ports}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ SHALLOW}}
\DoxyCodeLine{00143\ \ \ \ \ raw\_analog[0]\ =\ \mbox{\hyperlink{scheduler_8hpp_a951ac31de71c2bf701a13e5f233fc6d8}{ads}}.readADC\_SingleEnded(1);}
\DoxyCodeLine{00144\ \ \ \ \ voltage[0]\ =\ raw\_analog[0]\ *\ 0.0001875;}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ MIDDLE}}
\DoxyCodeLine{00146\ \ \ \ \ raw\_analog[1]\ =\ \mbox{\hyperlink{scheduler_8hpp_a951ac31de71c2bf701a13e5f233fc6d8}{ads}}.readADC\_SingleEnded(2);}
\DoxyCodeLine{00147\ \ \ \ \ voltage[1]\ =\ raw\_analog[1]\ *\ 0.0001875;}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ DEEP}}
\DoxyCodeLine{00149\ \ \ \ \ raw\_analog[2]\ =\ \mbox{\hyperlink{scheduler_8hpp_a951ac31de71c2bf701a13e5f233fc6d8}{ads}}.readADC\_SingleEnded(3);}
\DoxyCodeLine{00150\ \ \ \ \ voltage[2]\ =\ raw\_analog[2]\ *\ 0.0001875;}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ ANALOG/pH}}
\DoxyCodeLine{00152\ \ \ \ \ raw\_analog[3]\ =\ \mbox{\hyperlink{scheduler_8hpp_a951ac31de71c2bf701a13e5f233fc6d8}{ads}}.readADC\_SingleEnded(0);}
\DoxyCodeLine{00153\ \ \ \ \ voltage[3]\ =\ raw\_analog[3]\ *\ 0.0001875;}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ read\ I2C\ sensors}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{char}\ pH\_normal[32];}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordtype}{char}\ pH\_shallow[32];}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordtype}{char}\ pH\_middle[32];}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordtype}{char}\ pH\_deep[32];}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{comment}{//\ NORMAL}}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{if}(ezopH\_converter-\/>sensor\_at\_address(EZO\_I2C\_ADDR))\{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ strcpy(pH\_normal,\ ezopH\_converter-\/>getpH\_str(EZO\_I2C\_ADDR));}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ ezopH\_converter-\/>clear\_pH\_str();}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ build\ pH\ mqtt\ message}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ std::string\ topic\ =\ ezopH\_converter-\/>getSensorType()\ +\ \textcolor{stringliteral}{"{}/pH/normal/"{}}\ +\ mac\_str;}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{comment}{//std::string\ msg\ =\ "{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}\ +\ mac\_str\ +\ "{}\(\backslash\)"{},"{}\ +\ pH\_converter-\/>toJSON(voltage[3])\ +\ "{}\}"{};}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ mac\_str\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ \(\backslash\)"{}PH\(\backslash\)"{}:"{}}\ +\ pH\_normal\ +\ \textcolor{stringliteral}{"{}\}"{}};}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ topic,\ msg);}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(topic,\ msg);}
\DoxyCodeLine{00170\ \ \ \ \ }
\DoxyCodeLine{00171\ \ \ \ \ \}\textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)tno\ pH\ at\ addr\ 99"{}});}
\DoxyCodeLine{00173\ \ \ \ \ \}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ SHALLOW}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{if}(ezopH\_converter-\/>sensor\_at\_address(EZO\_I2C\_SHALLOW\_ADDR))\{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ strcpy(pH\_shallow,\ ezopH\_converter-\/>getpH\_str(EZO\_I2C\_SHALLOW\_ADDR));}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ ezopH\_converter-\/>clear\_pH\_str();}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ build\ pH\ mqtt\ message}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ std::string\ topic\ =\ ezopH\_converter-\/>getSensorType()\ +\ \textcolor{stringliteral}{"{}/pH/shallow/"{}}\ +\ mac\_str;}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{comment}{//std::string\ msg\ =\ "{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}\ +\ mac\_str\ +\ "{}\(\backslash\)"{},"{}\ +\ pH\_converter-\/>toJSON(voltage[3])\ +\ "{}\}"{};}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ mac\_str\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ \(\backslash\)"{}PH\(\backslash\)"{}:"{}}\ +\ pH\_shallow\ +\ \textcolor{stringliteral}{"{}\}"{}};}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ topic,\ msg);}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(topic,\ msg);}
\DoxyCodeLine{00184\ \ \ \ \ }
\DoxyCodeLine{00185\ \ \ \ \ \}\textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)tno\ pH\ at\ addr\ shallow"{}});}
\DoxyCodeLine{00187\ \ \ \ \ \}}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ MIDDLE}}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordflow}{if}(ezopH\_converter-\/>sensor\_at\_address(EZO\_I2C\_MIDDLE\_ADDR))\{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ strcpy(pH\_middle,\ ezopH\_converter-\/>getpH\_str(EZO\_I2C\_MIDDLE\_ADDR));}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ ezopH\_converter-\/>clear\_pH\_str();}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ std::string\ topic\ =\ ezopH\_converter-\/>getSensorType()\ +\ \textcolor{stringliteral}{"{}/pH/middle/"{}}\ +\ mac\_str;}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{comment}{//std::string\ msg\ =\ "{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}\ +\ mac\_str\ +\ "{}\(\backslash\)"{},"{}\ +\ pH\_converter-\/>toJSON(voltage[3])\ +\ "{}\}"{};}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ mac\_str\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ \(\backslash\)"{}PH\(\backslash\)"{}:"{}}\ +\ pH\_middle\ +\ \textcolor{stringliteral}{"{}\}"{}};}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ topic,\ msg);}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(topic,\ msg);}
\DoxyCodeLine{00197\ \ \ \ \ }
\DoxyCodeLine{00198\ \ \ \ \ \}\textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)tno\ pH\ at\ addr\ middle"{}});}
\DoxyCodeLine{00200\ \ \ \ \ \}}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ DEEP}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{if}(ezopH\_converter-\/>sensor\_at\_address(EZO\_I2C\_DEEP\_ADDR))\{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ strcpy(pH\_deep,\ ezopH\_converter-\/>getpH\_str(EZO\_I2C\_DEEP\_ADDR));}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ ezopH\_converter-\/>clear\_pH\_str();}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ std::string\ topic\ =\ ezopH\_converter-\/>getSensorType()\ +\ \textcolor{stringliteral}{"{}/pH/deep/"{}}\ +\ mac\_str;}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//std::string\ msg\ =\ "{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}\ +\ mac\_str\ +\ "{}\(\backslash\)"{},"{}\ +\ pH\_converter-\/>toJSON(voltage[3])\ +\ "{}\}"{};}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ mac\_str\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ \(\backslash\)"{}PH\(\backslash\)"{}:"{}}\ +\ pH\_deep\ +\ \textcolor{stringliteral}{"{}\}"{}};}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ topic,\ msg);}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(topic,\ msg);}
\DoxyCodeLine{00210\ \ \ \ \ }
\DoxyCodeLine{00211\ \ \ \ \ \}\textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)tno\ pH\ at\ addr\ deep"{}});}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ free(pH\_converter);}
\DoxyCodeLine{00216\ \ \ \ \ }
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{comment}{//\ turn\ off\ power\ to\ sensors}}
\DoxyCodeLine{00218\ \ \ \ \ digitalWrite(\mbox{\hyperlink{pinout_8hpp_ab241a96e494c05c7b5288a549f6c0c01}{PWR\_EN}},\ LOW);}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ build\ VWC\ mqtt\ message}}
\DoxyCodeLine{00221\ \ \ \ \ std::string\ brand\ =\ vwc\_converter-\/>\mbox{\hyperlink{classVWCSensor_a92a5fd826886da4f7961193daeaaf82e}{getSensorType}}();}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordflow}{if}(WiFi.status()\ ==\ WL\_CONNECTED\ \&\&\ !mqtt\_client.connected())\{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ not\ connected"{}});}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ instance.reconnect(mqtt\_client);}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\{}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ std::string\ depth\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}(i)\{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 0:}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ depth\ =\ \textcolor{stringliteral}{"{}shallow"{}};}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ depth\ =\ \textcolor{stringliteral}{"{}middle"{}};}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ depth\ =\ \textcolor{stringliteral}{"{}deep"{}};}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ std::string\ topic\ =\ brand\ +\ \textcolor{stringliteral}{"{}/"{}}\ +\ std::to\_string(i)\ +\ std::string(\textcolor{stringliteral}{"{}\_"{}})\ +\ depth\ +\ std::string(\textcolor{stringliteral}{"{}/"{}})\ +\ mac\_str;}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{\(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ mac\_str\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ \(\backslash\)"{}DEPTH\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ depth\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ "{}}\ +\ vwc\_converter-\/>\mbox{\hyperlink{classVWCSensor_a26734d5d7a7dfc050e16fc38c4c49f2d}{toJSON}}(voltage[i])\ +\ \textcolor{stringliteral}{"{}\}"{}};}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ topic,\ msg);}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(topic,\ msg);}
\DoxyCodeLine{00247\ \ \ \ \ \}}
\DoxyCodeLine{00248\ \ \ \ \ free(vwc\_converter);}
\DoxyCodeLine{00249\ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00254\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_a2137cbb31cc2a84abc73c9420ea062f1}{OTAUpdate}}()\{}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}[OTA]\ ran"{}});}
\DoxyCodeLine{00256\ \ \ \ \ attempt\_update();}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00262\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_a463da0b6a8745959b8d837ae6ee2c6f5}{PatWDT}}()\{}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}[WDT]\ ran"{}});}
\DoxyCodeLine{00264\ \ \ \ \ digitalWrite(\mbox{\hyperlink{pinout_8hpp_abe6b865c045f3e7c6892ef4f15ff5779}{DONE}},\ HIGH);}
\DoxyCodeLine{00265\ \ \ \ \ vTaskDelay(pdMS\_TO\_TICKS(10));}
\DoxyCodeLine{00266\ \ \ \ \ digitalWrite(\mbox{\hyperlink{pinout_8hpp_abe6b865c045f3e7c6892ef4f15ff5779}{DONE}},\ LOW);}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00272\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_af6136b721c9ebd2c70157f07e7061f96}{SendTLM}}()\{}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ Serial.println(\textcolor{stringliteral}{"{}[TLM]\ queueing\ data"{}});}
\DoxyCodeLine{00275\ \ \ \ \ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ digitalWrite(\mbox{\hyperlink{pinout_8hpp_ab241a96e494c05c7b5288a549f6c0c01}{PWR\_EN}},\ HIGH);}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \ \ MQTTMailer\ instance\ =\ MQTTMailer::getInstance();}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{keywordflow}{if}(WiFi.status()\ ==\ WL\_CONNECTED\ \&\&\ !mqtt\_client.connected())\{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{main_8cpp_a45a3fd1220b5c8c7557fb18db8c20e50}{USB\_DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}\(\backslash\)t-\/>\ not\ connected"{}});}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ instance.reconnect(mqtt\_client);}
\DoxyCodeLine{00284\ \ \ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ std::string\ fw\_version\ =\ \textcolor{stringliteral}{"{}V"{}}\ +\ std::to\_string(VERSION\_MAJOR)\ +\ \textcolor{stringliteral}{"{}."{}}\ +\ std::to\_string(VERSION\_MINOR)\ +\ \textcolor{stringliteral}{"{}."{}}\ +\ std::to\_string(VERSION\_PATCH);}
\DoxyCodeLine{00287\ \ \ \ \ std::string\ topic\ =\ \textcolor{stringliteral}{"{}datagator/tlm/"{}}\ +\ std::string(WiFi.macAddress().c\_str());}
\DoxyCodeLine{00288\ \ \ \ \ std::string\ msg\ =\ \textcolor{stringliteral}{"{}\{\ \(\backslash\)"{}MAC\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ std::string(WiFi.macAddress().c\_str())\ +\ }
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ \(\backslash\)"{}FIRMWARE\_VERSION\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ fw\_version\ +\ }
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)"{},\ \(\backslash\)"{}RSSI\(\backslash\)"{}:\ "{}}\ +\ std::to\_string(WiFi.RSSI())\ +\ }
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}BSSID\(\backslash\)"{}:\ \(\backslash\)"{}"{}}\ +\ WiFi.BSSIDstr().c\_str()\ +\ \textcolor{stringliteral}{"{}\(\backslash\)"{}"{}};}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordflow}{if}(maxlipo\_attached)\{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ msg\ =\ msg\ +\ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}BATT\_VOLTAGE\(\backslash\)"{}:\ "{}}\ +\ std::to\_string(\mbox{\hyperlink{scheduler_8hpp_a106fc9194d62779ffe942b866046530d}{maxlipo}}.cellVoltage())\ +}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}BATT\_PERCENTAGE\(\backslash\)"{}:\ "{}}\ +\ std::to\_string(\mbox{\hyperlink{scheduler_8hpp_a106fc9194d62779ffe942b866046530d}{maxlipo}}.cellPercent())\ +\ \textcolor{stringliteral}{"{}\}"{}};}
\DoxyCodeLine{00296\ \ \ \ \ \}\textcolor{keywordflow}{else}\{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ msg\ =\ msg\ +\ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}BATT\_VOLTAGE\(\backslash\)"{}:\ -\/1"{}}\ +}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{},\ \(\backslash\)"{}BATT\_PERCENTAGE\(\backslash\)"{}:\ -\/1\}"{}};}
\DoxyCodeLine{00299\ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \ \ }
\DoxyCodeLine{00301\ \ \ \ \ digitalWrite(\mbox{\hyperlink{pinout_8hpp_ab241a96e494c05c7b5288a549f6c0c01}{PWR\_EN}},\ LOW);}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{comment}{//instance.mailMessage(\&mqtt\_client,\ topic,\ msg);}}
\DoxyCodeLine{00303\ \ \ \ \ \mbox{\hyperlink{logger_8hpp_a2799093145858620308ff4421e6a1ea3}{log\_data}}(topic,\ msg);}
\DoxyCodeLine{00304\ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00312\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_a40655c198dfde88ff025be197f8bc0ea}{Scheduler}}(\textcolor{keywordtype}{int}\ reset\_count)\{}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{comment}{//\ bounds\ checking\ -\/>\ error\ msgs}}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{keywordflow}{if}(reset\_count\ <\ 0\ ||\ reset\_count\ >\ \mbox{\hyperlink{config_8hpp_ae14eaaed1fe7cdf491da54a714c426b3}{MAX\_COUNT}}\ ||\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ >\ reset\_count)\{}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\ Serial.println(\textcolor{stringliteral}{"{}[ERROR]\ over\ ran\ max\ reset\ count\ without\ reseting\ count,\ check\ if\ variable\ is\ being\ reset\ or\ if\ tasks\ are\ not\ completing"{}});}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{comment}{//Serial.printf("{}\(\backslash\)tPlanner\ \{\ read\ analog\ [\%d],\ read\ ht\ [\%d],\ published\ MQTT\ [\%d]\ \}\(\backslash\)n"{},\ planner.readAnalog,\ planner.readHT,\ planner.publishedMQTT);}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ reset\_count\ =\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ =\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}}\ =\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}}\ =\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}}\ =\ 1;}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}reset\_count"{}},\ reset\_count);\ \ }
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}analog\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}});}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ht\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}});}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ota\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}});}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}tlm\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}});}
\DoxyCodeLine{00324\ \ \ \ \ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_vwc\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_a63929664348237323cf24eda9d046748}{VWC\_FREQ}};}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_ht\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_ab8f6d4487aad03d548ccaba7645f7722}{HT\_FREQ}};}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_ota\_update\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_a5420655b6c292f8b3999b35374ff686a}{OTA\_FREQ}};}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keywordtype}{bool}\ run\_tlm\ =\ reset\_count\ -\/\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}}\ >=\ \mbox{\hyperlink{config_8hpp_a4665514bc689b72073e4f94e00e0cb1e}{TLM\_FREQ}};}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{keywordflow}{if}(run\_vwc)\{}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler_8hpp_ae6b4c9f02d24e6345a8244b129cb4bce}{ReadWired}}();}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}}\ =\ reset\_count;}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}analog\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_aec15be434a9427f8071b39d9819b6262}{analog\_t0}});}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ mqtt\_client.loop();}
\DoxyCodeLine{00336\ \ \ \ \ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{keywordflow}{if}(run\_ht)\{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler_8hpp_a2ce5745ffb225d3a8167ba1970e3b777}{ReadHT}}();}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}}\ =\ reset\_count;}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ht\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a8053e07d44e53920803b4c02dd48008c}{ht\_t0}});}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Publish\ happens\ in\ callback\ function}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ mqtt\_client.loop();}
\DoxyCodeLine{00344\ \ \ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keywordflow}{if}(run\_ota\_update)\{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}}\ =\ reset\_count;}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ota\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a6c06430db7ca522050ff7b27ea5ca487}{ota\_t0}});}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler_8hpp_a2137cbb31cc2a84abc73c9420ea062f1}{OTAUpdate}}();}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ mqtt\_client.loop();}
\DoxyCodeLine{00351\ \ \ \ \ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{keywordflow}{if}(run\_tlm)\{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{scheduler_8hpp_af6136b721c9ebd2c70157f07e7061f96}{SendTLM}}();}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}}\ =\ reset\_count;}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}tlm\_t0"{}},\ \mbox{\hyperlink{structplanner}{planner}}.\mbox{\hyperlink{structplanner_a9fbe58c903893e4dc56d5ded1cb0bfd4}{tlm\_t0}});}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ mqtt\_client.loop();}
\DoxyCodeLine{00358\ \ \ \ \ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \}}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00367\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{scheduler_8hpp_af44cadcb682d8c434f4c30a70cd62aa9}{SchedulerClearAll}}(\textcolor{keywordtype}{int}\ reset\_count)\{}
\DoxyCodeLine{00368\ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ota\_t0"{}},\ reset\_count);}
\DoxyCodeLine{00369\ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}tlm\_t0"{}},\ reset\_count);}
\DoxyCodeLine{00370\ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}analog\_t0"{}},\ reset\_count);}
\DoxyCodeLine{00371\ \ \ \ \ \mbox{\hyperlink{main_8cpp_add9553c173198049d23f8a89fe11142c}{gator\_prefs}}.putInt(\textcolor{stringliteral}{"{}ht\_t0"{}},\ reset\_count);}
\DoxyCodeLine{00372\ \}}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
