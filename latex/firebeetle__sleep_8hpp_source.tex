\doxysection{firebeetle\+\_\+sleep.\+hpp}
\hypertarget{firebeetle__sleep_8hpp_source}{}\label{firebeetle__sleep_8hpp_source}\index{include/firebeetle\_sleep.hpp@{include/firebeetle\_sleep.hpp}}
\mbox{\hyperlink{firebeetle__sleep_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ <esp\_pm.h>}}
\DoxyCodeLine{00012\ }
\DoxyCodeLine{00013\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#define\ uS\_TO\_S\_FACTOR\ 1000000ULL\ \ }\textcolor{comment}{/*\ Conversion\ factor\ for\ micro\ seconds\ to\ seconds\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ TIME\_TO\_SLEEP\ \ 5\ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ Time\ ESP32\ will\ go\ to\ sleep\ (in\ seconds)\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ RTC\_DATA\_ATTR\ \textcolor{keywordtype}{int}\ bootCount\ =\ 0;}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00025\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a83aeba5587a4364be71fbe7633b1caef}{deep\_sleep}}(uint16\_t\ time\_to\_sleep)\{}
\DoxyCodeLine{00026\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ \ First\ we\ configure\ the\ wake\ up\ source}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ \ We\ set\ our\ ESP32\ to\ wake\ up\ every\ 5\ seconds}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00030\ \ \ esp\_sleep\_enable\_timer\_wakeup(time\_to\_sleep\ *\ uS\_TO\_S\_FACTOR);}
\DoxyCodeLine{00031\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ \ http://esp-\/idf.readthedocs.io/en/latest/api-\/reference/system/deep\_sleep.html}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ \ Left\ the\ line\ commented\ as\ an\ example\ of\ how\ to\ configure\ peripherals.}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ \ The\ line\ below\ turns\ off\ all\ RTC\ peripherals\ in\ deep\ sleep.}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00036\ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_PERIPH,\ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \textcolor{comment}{//esp\_bt\_controller\_disable();}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ esp\_deep\_sleep\_start();}
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00048\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a095807b6c0d23ed1b2d39dd8244b7e30}{hibernate}}(uint16\_t\ time\_to\_sleep)\ \{}
\DoxyCodeLine{00049\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_PERIPH,\ \ \ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00050\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_SLOW\_MEM,\ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00051\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_FAST\_MEM,\ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00052\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_XTAL,\ \ \ \ \ \ \ \ \ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00053\ \ \ \ \ }
\DoxyCodeLine{00054\ \ \ \ \ \mbox{\hyperlink{firebeetle__sleep_8hpp_a83aeba5587a4364be71fbe7633b1caef}{deep\_sleep}}(time\_to\_sleep);}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00063\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a0958ecc013d917b125db3899ee2aa968}{light\_sleep}}()\{}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//esp\_pm\_configure();}}
\DoxyCodeLine{00065\ \ \ esp\_light\_sleep\_start();\ }
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00073\ uint16\_t\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a12735d59e634b566bdaae00c20792f44}{seconds\_to\_uS}}(uint16\_t\ seconds)\{}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{return}\ seconds\ *\ uS\_TO\_S\_FACTOR;}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00081\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a543437c02eec098c6cf5171b3f0a58fd}{print\_wakeup\_reason}}()\{}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\{}
\DoxyCodeLine{00083\ \ \ \ \ esp\_sleep\_wakeup\_cause\_t\ wakeup\_reason;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ wakeup\_reason\ =\ esp\_sleep\_get\_wakeup\_cause();}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordflow}{switch}(wakeup\_reason)}
\DoxyCodeLine{00088\ \ \ \ \ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_EXT0\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ external\ signal\ using\ RTC\_IO"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_EXT1\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ external\ signal\ using\ RTC\_CNTL"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_TIMER\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ timer"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_TOUCHPAD\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ touchpad"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_ULP\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ ULP\ program"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00094\ \ \ \ \ \ \ default\ :\ Serial.printf(\textcolor{stringliteral}{"{}Wakeup\ was\ not\ caused\ by\ deep\ sleep:\ \%d\(\backslash\)n"{}},wakeup\_reason);\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \}}
\DoxyCodeLine{00097\ \}}

\end{DoxyCode}
