\doxysection{firebeetle\+\_\+sleep.\+hpp}
\hypertarget{firebeetle__sleep_8hpp_source}{}\label{firebeetle__sleep_8hpp_source}\index{include/firebeetle\_sleep.hpp@{include/firebeetle\_sleep.hpp}}
\mbox{\hyperlink{firebeetle__sleep_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ <Arduino.h>}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ <esp\_pm.h>}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ uS\_TO\_S\_FACTOR\ 1000000ULL\ \ }}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#define\ TIME\_TO\_SLEEP\ \ 5\ \ \ \ \ \ \ \ }}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ RTC\_DATA\_ATTR\ \textcolor{keywordtype}{int}\ bootCount\ =\ 0;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00029\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a83aeba5587a4364be71fbe7633b1caef}{deep\_sleep}}(uint16\_t\ time\_to\_sleep)\{}
\DoxyCodeLine{00030\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ \ First\ we\ configure\ the\ wake\ up\ source}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ \ We\ set\ our\ ESP32\ to\ wake\ up\ every\ 5\ seconds}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00034\ \ \ esp\_sleep\_enable\_timer\_wakeup(time\_to\_sleep\ *\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a628c12ff2a1ac4b14a41f021723b2558}{uS\_TO\_S\_FACTOR}});}
\DoxyCodeLine{00035\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ \ http://esp-\/idf.readthedocs.io/en/latest/api-\/reference/system/deep\_sleep.html}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ \ Left\ the\ line\ commented\ as\ an\ example\ of\ how\ to\ configure\ peripherals.}}
\DoxyCodeLine{00038\ \textcolor{comment}{\ \ The\ line\ below\ turns\ off\ all\ RTC\ peripherals\ in\ deep\ sleep.}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00040\ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_PERIPH,\ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//esp\_bt\_controller\_disable();}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ esp\_deep\_sleep\_start();}
\DoxyCodeLine{00045\ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00052\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a095807b6c0d23ed1b2d39dd8244b7e30}{hibernate}}(uint16\_t\ time\_to\_sleep)\ \{}
\DoxyCodeLine{00053\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_PERIPH,\ \ \ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00054\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_SLOW\_MEM,\ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00055\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_RTC\_FAST\_MEM,\ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00056\ \ \ \ \ esp\_sleep\_pd\_config(ESP\_PD\_DOMAIN\_XTAL,\ \ \ \ \ \ \ \ \ ESP\_PD\_OPTION\_OFF);}
\DoxyCodeLine{00057\ \ \ \ \ }
\DoxyCodeLine{00058\ \ \ \ \ \mbox{\hyperlink{firebeetle__sleep_8hpp_a83aeba5587a4364be71fbe7633b1caef}{deep\_sleep}}(time\_to\_sleep);}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a0958ecc013d917b125db3899ee2aa968}{light\_sleep}}()\{}
\DoxyCodeLine{00068\ \ \ \textcolor{comment}{//esp\_pm\_configure();}}
\DoxyCodeLine{00069\ \ \ esp\_light\_sleep\_start();\ }
\DoxyCodeLine{00070\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00077\ uint16\_t\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a12735d59e634b566bdaae00c20792f44}{seconds\_to\_uS}}(uint16\_t\ seconds)\{}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{return}\ seconds\ *\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a628c12ff2a1ac4b14a41f021723b2558}{uS\_TO\_S\_FACTOR}};}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00085\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{firebeetle__sleep_8hpp_a543437c02eec098c6cf5171b3f0a58fd}{print\_wakeup\_reason}}()\{}
\DoxyCodeLine{00086\ \ \ \textcolor{keywordflow}{if}(\mbox{\hyperlink{config_8hpp_ad72dbcf6d0153db1b8d8a58001feed83}{DEBUG}})\{}
\DoxyCodeLine{00087\ \ \ \ \ esp\_sleep\_wakeup\_cause\_t\ wakeup\_reason;}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ wakeup\_reason\ =\ esp\_sleep\_get\_wakeup\_cause();}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{switch}(wakeup\_reason)}
\DoxyCodeLine{00092\ \ \ \ \ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_EXT0\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ external\ signal\ using\ RTC\_IO"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_EXT1\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ external\ signal\ using\ RTC\_CNTL"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_TIMER\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ timer"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_TOUCHPAD\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ touchpad"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ESP\_SLEEP\_WAKEUP\_ULP\ :\ Serial.println(\textcolor{stringliteral}{"{}Wakeup\ caused\ by\ ULP\ program"{}});\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00098\ \ \ \ \ \ \ default\ :\ Serial.printf(\textcolor{stringliteral}{"{}Wakeup\ was\ not\ caused\ by\ deep\ sleep:\ \%d\(\backslash\)n"{}},wakeup\_reason);\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ \ \ \}}
\DoxyCodeLine{00101\ \}}

\end{DoxyCode}
