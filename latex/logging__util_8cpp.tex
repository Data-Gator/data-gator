\doxysection{include/logging\+\_\+util.cpp File Reference}
\hypertarget{logging__util_8cpp}{}\label{logging__util_8cpp}\index{include/logging\_util.cpp@{include/logging\_util.cpp}}


Utilities for logging data.  


{\ttfamily \#include $<$Preferences.\+h$>$}\newline
{\ttfamily \#include $<$NTPClient.\+h$>$}\newline
{\ttfamily \#include $<$Time\+Stamp.\+hpp$>$}\newline
{\ttfamily \#include $<$SDLogger.\+hpp$>$}\newline
{\ttfamily \#include $<$SDReader.\+hpp$>$}\newline
Include dependency graph for logging\+\_\+util.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{logging__util_8cpp__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=212pt]{logging__util_8cpp__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
std\+::string \mbox{\hyperlink{logging__util_8cpp_a27e949dc420cd22ef8c220d82cc8259f}{cache\+\_\+retrieve\+\_\+timestamp}} ()
\item 
void \mbox{\hyperlink{logging__util_8cpp_a84557373ab4c41663554890c5589bc3c}{cache\+\_\+timestamp}} (std\+::string timestamp)
\item 
bool \mbox{\hyperlink{logging__util_8cpp_ae48655ee393afdbed2a929b09c9a724a}{init\+\_\+data\+\_\+logger}} ()
\begin{DoxyCompactList}\small\item\em Initialize logging interfaces. \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{logging__util_8cpp_a55a2c93667516d15e039732826250596}{get\+\_\+log\+\_\+filename}} (Time\+Stamp\+Parser \texorpdfstring{$\ast$}{*})
\item 
void \mbox{\hyperlink{logging__util_8cpp_a9b87f9c41c4be140985330e569dcc999}{log\+\_\+to\+\_\+sd\+\_\+file}} (std\+::string filename, std\+::string time, std\+::string topic, std\+::string message)
\item 
void \mbox{\hyperlink{logging__util_8cpp_aa0288d721e9a933c0494590b09c7d810}{cache\+\_\+log\+\_\+offset}} (int log\+\_\+offset)
\item 
int \mbox{\hyperlink{logging__util_8cpp_abc8f9c3ac6f2042bc5fc8660063aad5e}{cache\+\_\+retrieve\+\_\+log\+\_\+offset}} (void)
\item 
void \mbox{\hyperlink{logging__util_8cpp_ac8d97b37dcabe2cc9a8a3452672449bf}{log\+\_\+to\+\_\+sd\+\_\+file}} (SDLogger \texorpdfstring{$\ast$}{*}l, std\+::string time, std\+::string topic, std\+::string message)
\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
Preferences \mbox{\hyperlink{logging__util_8cpp_add9553c173198049d23f8a89fe11142c}{gator\+\_\+prefs}}
\item 
\Hypertarget{logging__util_8cpp_a618f91fbc4c35bde353fc1732d389a69}\label{logging__util_8cpp_a618f91fbc4c35bde353fc1732d389a69} 
bool {\bfseries logging\+\_\+available} = false
\item 
\Hypertarget{logging__util_8cpp_ac0b73c0ce5c9049c6073dc70fc9bb227}\label{logging__util_8cpp_ac0b73c0ce5c9049c6073dc70fc9bb227} 
bool {\bfseries absolute\+\_\+timestamp\+\_\+available} = false
\item 
\Hypertarget{logging__util_8cpp_a0f9cf039424a99aff815f1fbb03eb9ca}\label{logging__util_8cpp_a0f9cf039424a99aff815f1fbb03eb9ca} 
bool {\bfseries logged\+\_\+relative\+\_\+data} = false
\item 
\Hypertarget{logging__util_8cpp_a437b44d29a55b718c85988d982c0f809}\label{logging__util_8cpp_a437b44d29a55b718c85988d982c0f809} 
std\+::string {\bfseries time\+\_\+stamp\+\_\+to\+\_\+cache} = "{}"{}
\item 
\Hypertarget{logging__util_8cpp_a446e0ace32278a3a0ee36f498eb24e04}\label{logging__util_8cpp_a446e0ace32278a3a0ee36f498eb24e04} 
SDLogger \texorpdfstring{$\ast$}{*} {\bfseries logger} = NULL
\item 
\Hypertarget{logging__util_8cpp_a9af592e268390420308fbf5e719d393a}\label{logging__util_8cpp_a9af592e268390420308fbf5e719d393a} 
Time\+Stamp\+Builder \texorpdfstring{$\ast$}{*} {\bfseries tsb} = NULL
\item 
\Hypertarget{logging__util_8cpp_a059cc83bd876c61f940532a2008071e3}\label{logging__util_8cpp_a059cc83bd876c61f940532a2008071e3} 
Time\+Stamp\+Parser \texorpdfstring{$\ast$}{*} {\bfseries tsp} = NULL
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Utilities for logging data. 

Define the helper functions/utilities which have been written for logging data on the Data Gators.

Emphasis is placed on making this as simple to use as possible.

\begin{DoxyAuthor}{Author}
Garrett Wells 
\end{DoxyAuthor}


\doxysubsection{Function Documentation}
\Hypertarget{logging__util_8cpp_aa0288d721e9a933c0494590b09c7d810}\label{logging__util_8cpp_aa0288d721e9a933c0494590b09c7d810} 
\index{logging\_util.cpp@{logging\_util.cpp}!cache\_log\_offset@{cache\_log\_offset}}
\index{cache\_log\_offset@{cache\_log\_offset}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{cache\_log\_offset()}{cache\_log\_offset()}}
{\footnotesize\ttfamily void cache\+\_\+log\+\_\+offset (\begin{DoxyParamCaption}\item[{int}]{log\+\_\+offset }\end{DoxyParamCaption})}

Save the reset count.


\begin{DoxyParams}{Parameters}
{\em int} & The offset in ticks. \\
\hline
\end{DoxyParams}
\Hypertarget{logging__util_8cpp_abc8f9c3ac6f2042bc5fc8660063aad5e}\label{logging__util_8cpp_abc8f9c3ac6f2042bc5fc8660063aad5e} 
\index{logging\_util.cpp@{logging\_util.cpp}!cache\_retrieve\_log\_offset@{cache\_retrieve\_log\_offset}}
\index{cache\_retrieve\_log\_offset@{cache\_retrieve\_log\_offset}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{cache\_retrieve\_log\_offset()}{cache\_retrieve\_log\_offset()}}
{\footnotesize\ttfamily int cache\+\_\+retrieve\+\_\+log\+\_\+offset (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

Retrieves the reset count.

\begin{DoxyReturn}{Returns}
Number of resets/times the device as booted. 
\end{DoxyReturn}
\Hypertarget{logging__util_8cpp_a27e949dc420cd22ef8c220d82cc8259f}\label{logging__util_8cpp_a27e949dc420cd22ef8c220d82cc8259f} 
\index{logging\_util.cpp@{logging\_util.cpp}!cache\_retrieve\_timestamp@{cache\_retrieve\_timestamp}}
\index{cache\_retrieve\_timestamp@{cache\_retrieve\_timestamp}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{cache\_retrieve\_timestamp()}{cache\_retrieve\_timestamp()}}
{\footnotesize\ttfamily std\+::string cache\+\_\+retrieve\+\_\+timestamp (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Retrieve time stamp from non-\/volatile memory so that it can be used for log file access.

\begin{DoxyReturn}{Returns}
The string value stored in non-\/volatile memory, should be expected to be of format produced by Time\+Stamp\+Builder 
\end{DoxyReturn}
\Hypertarget{logging__util_8cpp_a84557373ab4c41663554890c5589bc3c}\label{logging__util_8cpp_a84557373ab4c41663554890c5589bc3c} 
\index{logging\_util.cpp@{logging\_util.cpp}!cache\_timestamp@{cache\_timestamp}}
\index{cache\_timestamp@{cache\_timestamp}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{cache\_timestamp()}{cache\_timestamp()}}
{\footnotesize\ttfamily void cache\+\_\+timestamp (\begin{DoxyParamCaption}\item[{std\+::string}]{timestamp }\end{DoxyParamCaption})}

Cache/update the last known absolute timestamp from the NTPClient to non-\/volatile memory


\begin{DoxyParams}{Parameters}
{\em timestamp} & a timestamp string following the syntax of Time\+Stamp\+Builder \\
\hline
\end{DoxyParams}
\Hypertarget{logging__util_8cpp_a55a2c93667516d15e039732826250596}\label{logging__util_8cpp_a55a2c93667516d15e039732826250596} 
\index{logging\_util.cpp@{logging\_util.cpp}!get\_log\_filename@{get\_log\_filename}}
\index{get\_log\_filename@{get\_log\_filename}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{get\_log\_filename()}{get\_log\_filename()}}
{\footnotesize\ttfamily std\+::string get\+\_\+log\+\_\+filename (\begin{DoxyParamCaption}\item[{Time\+Stamp\+Parser \texorpdfstring{$\ast$}{*}}]{tsp }\end{DoxyParamCaption})}

Generate a file name based on the current time stamp. Should only be called if Time\+Stamp\+Builder has been updated.


\begin{DoxyParams}{Parameters}
{\em Time\+Stamp\+Parser} & which defines parser for reading the current time stamp from a string. \\
\hline
\end{DoxyParams}
\Hypertarget{logging__util_8cpp_ae48655ee393afdbed2a929b09c9a724a}\label{logging__util_8cpp_ae48655ee393afdbed2a929b09c9a724a} 
\index{logging\_util.cpp@{logging\_util.cpp}!init\_data\_logger@{init\_data\_logger}}
\index{init\_data\_logger@{init\_data\_logger}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{init\_data\_logger()}{init\_data\_logger()}}
{\footnotesize\ttfamily bool init\+\_\+data\+\_\+logger (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initialize logging interfaces. 

Perform all initialization necessary before logging any data with log\+\_\+message to the u\+SD card.

\begin{DoxyReturn}{Returns}
bool true if successfully initialized, false for\+:
\begin{DoxyItemize}
\item no SD card detected
\item some other potential error 
\end{DoxyItemize}
\end{DoxyReturn}
\Hypertarget{logging__util_8cpp_ac8d97b37dcabe2cc9a8a3452672449bf}\label{logging__util_8cpp_ac8d97b37dcabe2cc9a8a3452672449bf} 
\index{logging\_util.cpp@{logging\_util.cpp}!log\_to\_sd\_file@{log\_to\_sd\_file}}
\index{log\_to\_sd\_file@{log\_to\_sd\_file}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{log\_to\_sd\_file()}{log\_to\_sd\_file()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily void log\+\_\+to\+\_\+sd\+\_\+file (\begin{DoxyParamCaption}\item[{SDLogger \texorpdfstring{$\ast$}{*}}]{l,  }\item[{std\+::string}]{time,  }\item[{std\+::string}]{topic,  }\item[{std\+::string}]{message }\end{DoxyParamCaption})}

Write an MQTT message to a file on the SD card. Requires a time stamp and filename.


\begin{DoxyParams}{Parameters}
{\em The} & SDLogger instance with all filename and separator information pre-\/set\\
\hline
{\em The} & time hr\+:min\+:sec+offset that will be written to the log file\\
\hline
{\em The} & mqtt topic the data should have been logged to\\
\hline
{\em The} & mqtt message containing the data we want to save \\
\hline
\end{DoxyParams}
\Hypertarget{logging__util_8cpp_a9b87f9c41c4be140985330e569dcc999}\label{logging__util_8cpp_a9b87f9c41c4be140985330e569dcc999} 
\index{logging\_util.cpp@{logging\_util.cpp}!log\_to\_sd\_file@{log\_to\_sd\_file}}
\index{log\_to\_sd\_file@{log\_to\_sd\_file}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{log\_to\_sd\_file()}{log\_to\_sd\_file()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily void log\+\_\+to\+\_\+sd\+\_\+file (\begin{DoxyParamCaption}\item[{std\+::string}]{filename,  }\item[{std\+::string}]{time,  }\item[{std\+::string}]{topic,  }\item[{std\+::string}]{message }\end{DoxyParamCaption})}

Write an MQTT message to a file on the SD card. Requires a time stamp and filename.


\begin{DoxyParams}{Parameters}
{\em The} & string file name to log the topic and message to. \\
\hline
{\em The} & string time, formatted according to Time\+Stamp\+Builder. \\
\hline
{\em The} & string topic, according to MQTT format. \\
\hline
{\em The} & message which contains data. Often JSON object. \\
\hline
\end{DoxyParams}


\doxysubsection{Variable Documentation}
\Hypertarget{logging__util_8cpp_add9553c173198049d23f8a89fe11142c}\label{logging__util_8cpp_add9553c173198049d23f8a89fe11142c} 
\index{logging\_util.cpp@{logging\_util.cpp}!gator\_prefs@{gator\_prefs}}
\index{gator\_prefs@{gator\_prefs}!logging\_util.cpp@{logging\_util.cpp}}
\doxysubsubsection{\texorpdfstring{gator\_prefs}{gator\_prefs}}
{\footnotesize\ttfamily Preferences gator\+\_\+prefs\hspace{0.3cm}{\ttfamily [extern]}}

NVS memory access interface. 